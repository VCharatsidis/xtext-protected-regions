h1(#top). Protected Region Support - Xtext Extension

The _Xtext Extension_ documentation is addressed to developers who want to benefit of protected region support in conjunction with Xtext.

h2(#toc). Table of Contents

* "Table of Contents":#toc
* "Motivation":#motivation
* "Usage":#usage
** "Plugin Configuration":#pluginConfig
** "Runtime Module Configuration":#runtimeModuleConfig
** "Portable Generators":#portableGenerators
** "Generator Configuration":#generatorConfiguration
*** "MWE2 Workflow":#mwe2Workflow
*** "Standalone Generator":#standaloneGenerator

"top":#top

h2(#motivation). Motivation

Lets assume you're already familiar with "Xtext":http://www.xtext.org. Then your existing IGenerator implementation likely will look like this:

bc.. 
void doGenerate(Resource input, IFileSystemAccess fsa) {

  // negleting iteration of input here
  CharSequence generatedCode = compile(...);
  
  // write generated code to file system
  fsa.generateFile(fileName, slot, generatedCode);
  
}
p. where @generatedCode@ is a CharSequence containing your generated code. *The goal is to preserve manual changes of the previously generated code*. These changes are denoted in so called "protected regions":https://github.com/danieldietrich/xtext-protectedregions/blob/master/net.danieldietrich.protectedregions/README.textile#intro.

"top":#top

h2(#usage). Usage

h3(#pluginConfig). Plugin Configuration

Edit your plug-in's @META-INF/MANIFEST.MF@ to import Xtext Protected Region Support packages:

bc. 
Import-Package: net.danieldietrich.protectedregions.core,
  net.danieldietrich.protectedregions.support,
  net.danieldietrich.protectedregions.xtext

"top":#top

h3(#runtimeModuleConfig). Runtime Module Configuration

Configure Guice to provide @JavaIoFileSystemAccess@ in your @RuntimeModule@ class.

*Example:*

bc.. 
public class MyRuntimeModule extends AbstractMyRuntimeModule {

  @Provides
  public JavaIoFileSystemAccess createJavaIoFileSystemAccess(IProtectedRegionSupport support) {
    IProtectedRegionSupport support = new ProtectedRegionSupport();
    support.addParser(RegionParserFactory.createJavaParser(), ".java");
    // support.setFilter(...); // (optional)
    return new BidiJavaIoFileSystemAccess(support);
  }

}
p. "top":#top

h3(#portableGenerators). Portable Generators

Your existing generator remains untouched.

bc.. 
override void doGenerate(Resource resource, IFileSystemAccess fsa) {

  // Look ma! Portable generators! No "proprietary" APIs, simply Xtext!
  fsa.generateFile(fileName, '''...Xtend/Xpand template here...''')

}
p. "top":#top

h3(#generatorConfiguration). Generator Configuration

Depending on whether you are using a MWE2 workflow or a standalone generator you might also want to modify the output path(s):

h4(#mwe2Workflow). MWE2 Workflow

With MWE2 workflows, output paths are declared like this:

bc. 
Workflow {
  // ...
  component = org.eclipse.xtext.generator.GeneratorComponent {
    // ...
    outlet = {
      path = targetDir
    }
  }
}

h4(#standaloneGenerator). Standalone Generator

Assuming that @fsa@ is an implementation of @AbstractFileSystemAccess@ (like @JavaIoFileSystemAccess@), output paths are configured as follows:

bc. fsa.setOutputPath(...); // triggers loading protected regions in the background(!)

"top":#top
